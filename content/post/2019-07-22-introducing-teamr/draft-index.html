---
title: Introducing teamr
author: 'admin'
date: '2019-07-22'
slug: introducing-teamr
categories:
  - R
tags:
  - R
  - Package
subtitle: ''
summary: ''
authors: ['admin']
lastmod: '2019-07-22T14:32:40Z'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
output:
  md_document:
    variant: markdown_github
---



<p>Today I am so pleased to introduce my first CRAN package for sending formatted
messages to Microsoft Teams, <a href="https://github.com/wwwjk366/teamr"><code>teamr</code></a>.</p>
<p>Motivation is simple here. For years I have been using Slack and built many slash commands and apps using incoming webhooks with R, but ever since I started to use Teams,
I found that we will have the same needs for communicating with R as well. So with some inspiration from the Python package <a href="https://pypi.org/project/pymsteams/"><code>pymsteams</code></a>.
I created <code>teamr</code> package with the hope that this package will provide a simple and clean way to talk to Teams from R.</p>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>You can install the released version of teamr from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<pre class="r"><code>install.packages(&quot;teamr&quot;)</code></pre>
<p>And the development version from <a href="https://github.com/">GitHub</a> with:</p>
<pre class="r"><code># install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;wwwjk366/teamr&quot;)
</code></pre>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>This is a basic example of send a simple titled message to MS Teams:</p>
<pre class="r"><code>library(teamr)

# initiate new connector card object
cc &lt;- connector_card$new(hookurl = &quot;https://outlook.office.com/webhook/...&quot;)
# add text
cc$text(&quot;This is text of main body.&quot;)
# add title
cc$title(&quot;This is message title&quot;)
# add hyperlink button
cc$add_link_button(&quot;Read more&quot;, &quot;https://www.google.com&quot;)
# change theme color
cc$color(&quot;#008000&quot;)</code></pre>
<p>We can print out the payload that will be sending to given webhook using <code>print</code> method</p>
<pre class="r"><code># print out the payload for checking
cc$print()</code></pre>
<pre><code>Card: 
  hookurl: https://outlook.office.com/webhook/...
  payload:  {&quot;text&quot;:&quot;This is text of main body.&quot;,&quot;title&quot;:&quot;This is message title&quot;,&quot;potentialAction&quot;:[{&quot;@context&quot;:&quot;http://schema.org&quot;,&quot;@type&quot;:&quot;ViewAction&quot;,&quot;name&quot;:&quot;Read more&quot;,&quot;target&quot;:[&quot;https://www.google.com&quot;]}],&quot;themeColor&quot;:&quot;#008000&quot;}</code></pre>
<p>Our <code>JSON</code> payload looks good, time to send it out :)</p>
<pre class="r"><code># send to Teams
cc$send()</code></pre>
<pre><code>Response [https://outlook.office.com/webhook/...]
  Date: 2019-07-22 16:29
  Status: 404
  Content-Type: text/html; charset=utf-8
  Size: 1.93 kB
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;The resource cannot be found.&lt;/title&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot; /&gt;
        &lt;style&gt;
         body {font-family:&quot;Verdana&quot;;font-weight:normal;font-size: .7em;...
         p {font-family:&quot;Verdana&quot;;font-weight:normal;color:black;margin-...
         b {font-family:&quot;Verdana&quot;;font-weight:bold;color:black;margin-to...
         H1 { font-family:&quot;Verdana&quot;;font-weight:normal;font-size:18pt;co...
...</code></pre>
<p><code>send</code> menthod will return <code>TRUE</code> if send was successful (status code 200). If it failed, it will return the reponse object for further investigation.
Our message with a link button will looks like this:</p>
<p><img src="media/main1.PNG" /></p>
<p>You probablity noticed now that this package is built using <code>R6</code> class(very nice tutorial by Hadley <a href="https://adv-r.hadley.nz/r6.html">here</a>).
I decide to do this way because by using OOP concept, it will give use a feeling that you are “building” your message by adding something piece by piece.
At the same time the code will be highly readable and easy to understand. <code>teamr</code> has 3 main classes as of today — <code>connector_card</code>, <code>card_section</code> and <code>action_card</code>.
For example, let’s add a section to our message:</p>
</div>
<div id="message-with-sections" class="section level2">
<h2>Message with sections</h2>
<pre class="r"><code>#initiate new card section object
sec &lt;- card_section$new()

sec$text(sec_text = &quot;2018-19 Finals MVP&quot;)
sec$add_fact(fname = &quot;Position&quot;, fvalue = &quot;Forward&quot;)
sec$title(sec_title = &quot;Player Info&quot;)
sec$activity_image(sec_activitiy_image = &quot;https://d2cwpp38twqe55.cloudfront.net/req/201905091/images/players/leonaka01.jpg&quot;)
sec$activity_title(sec_activity_title = &quot;Kawhi Leonard&quot;)
sec$activity_sub_title(sec_activitiy_subtitle = &quot;LA Clippers&quot;)
sec$activity_text(sec_activitiy_text = &quot;Activity text&quot;)
cc$add_section(new_section = sec)
cc$send()</code></pre>
<pre><code>Response [https://outlook.office.com/webhook/...]
  Date: 2019-07-22 16:29
  Status: 404
  Content-Type: text/html; charset=utf-8
  Size: 1.93 kB
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;The resource cannot be found.&lt;/title&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot; /&gt;
        &lt;style&gt;
         body {font-family:&quot;Verdana&quot;;font-weight:normal;font-size: .7em;...
         p {font-family:&quot;Verdana&quot;;font-weight:normal;color:black;margin-...
         b {font-family:&quot;Verdana&quot;;font-weight:bold;color:black;margin-to...
         H1 { font-family:&quot;Verdana&quot;;font-weight:normal;font-size:18pt;co...
...</code></pre>
<p>This is what you will get on you Teams channel:</p>
<p><img src="media/kawhi1.PNG" /></p>
</div>
<div id="message-with-action-cards" class="section level2">
<h2>Message with action cards</h2>
<p>Teams also support sending actionable messages. You can add a button to your message which can send HTTP reqeust to a certain URL with different type of inputs.</p>
<p>In the following example, I will add a multilined text input, a date selector and a multiple choice input to our message. Simply changing <code>target = &quot;http://...&quot;</code> in
<code>add_actions</code> method to the URL you want the reponse payload to be sent to:</p>
<pre class="r"><code># create new action card
pa &lt;- action_card$new(type = &quot;ActionCard&quot;, name = &quot;Add comment&quot;)
# add default actions to card
pa$add_actions(type = &quot;HttpPOST&quot;, name = &quot;Save&quot;, target = &quot;http://...&quot;)
# add text inputs
pa$add_text_inputs(id = &quot;comment&quot;, title = &quot;Add comment for this task&quot;, is_multi_line = TRUE)
# save to the card object
cc$add_potential_action(pa)

pa2 &lt;- action_card$new(type = &quot;ActionCard&quot;, name = &quot;Add Date&quot;)
pa2$add_actions(type = &quot;HttpPOST&quot;, name = &quot;Save&quot;, target = &quot;http://...&quot;)
pa2$add_date_inputs(id = &quot;date&quot;, title = &quot;Add Date for this task&quot;)
cc$add_potential_action(pa2)

pa3 &lt;- action_card$new(type = &quot;ActionCard&quot;, name = &quot;Add Options&quot;)
pa3$add_actions(type = &quot;HttpPOST&quot;, name = &quot;Save&quot;, target = &quot;http://...&quot;)
# add multiple choices. note that choices must be a nested named list
pa3$add_mchoice_inputs(id = &quot;mchoice&quot;, 
                       title = &quot;Choice one&quot;, 
                       is_multi_select = TRUE, 
                       choices = list(
                         list(display=&quot;In Progress&quot;, value=1),
                         list(display=&quot;Active&quot;, value=2),
                         list(display=&quot;Close&quot;, value=3))
                       )
cc$add_potential_action(pa3)

cc$send()</code></pre>
<pre><code>Response [https://outlook.office.com/webhook/...]
  Date: 2019-07-22 16:29
  Status: 404
  Content-Type: text/html; charset=utf-8
  Size: 1.93 kB
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;The resource cannot be found.&lt;/title&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot; /&gt;
        &lt;style&gt;
         body {font-family:&quot;Verdana&quot;;font-weight:normal;font-size: .7em;...
         p {font-family:&quot;Verdana&quot;;font-weight:normal;color:black;margin-...
         b {font-family:&quot;Verdana&quot;;font-weight:bold;color:black;margin-to...
         H1 { font-family:&quot;Verdana&quot;;font-weight:normal;font-size:18pt;co...
...</code></pre>
<p><img src="media/teamr.gif" /></p>
<p>If you want to learn more regarding Microsoft Connectors, you check out the offical doc <a href="https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/connectors/connectors-using">here</a>.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>This is my very first package on CRAN so if you found any bugs please report here <a href="https://github.com/wwwjk366/teamr/issues">https://github.com/wwwjk366/teamr/issues</a>.
I do have plan to add more functionality to the package so stay tuned!</p>
</div>
